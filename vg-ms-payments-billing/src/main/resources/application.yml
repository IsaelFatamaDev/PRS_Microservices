# =============================================================================
# MICROSERVICIO DE PAGO - SISTEMA JASS DIGITAL
# =============================================================================
spring:
     application:
          name: ${NOMBRE_MICROSERVICIO:vg_ms_payment}
     main:
          allow-circular-references: true

     r2dbc:
          url: ${SPRING_R2DBC_URL:r2dbc:postgresql://ep-silent-flower-ah11hszt-pooler.c-3.us-east-1.aws.neon.tech:5432/neondb?sslmode=require&channel_binding=require}
          username: ${SPRING_R2DBC_USERNAME:neondb_owner}
          password: ${SPRING_R2DBC_PASSWORD:npg_FvwbUB26GcHE}
          pool:
               # Pool reducido para ahorrar memoria
               initial-size: 2
               max-size: 8
               max-idle-time: 15m
               max-acquire-time: 30s
               max-create-connection-time: 30s
               validation-query: SELECT 1

     # Optimizaciones de caché y recursos
     web:
          resources:
               cache:
                    period: 3600

     # Desactivar JMX para ahorrar memoria
     jmx:
          enabled: false

     # Optimizar manejo de threads
     threads:
          virtual:
               enabled: true

# =============================================================================
# CONFIGURACIÓN DEL SERVIDOR
# =============================================================================
server:
     port: 8083
     forward-headers-strategy: framework
# =============================================================================
# INFORMACIÓN DE LA APLICACIÓN
# =============================================================================
app:
     name: Microservicio de Pago y Recibo
     description: Microservicio para gestión de Pagos y Recibo del Sistema JASS DIGITAL
     version: 2.0.0
     organization: Valle Grande

# =============================================================================
# CONFIGURACIÓN DE CLIENTES EXTERNOS (OTROS MICROSERVICIOS)
# =============================================================================
microservices:
     users:
          name: ms-users
          url: https://lab.vallegrande.edu.pe/jass/ms-gateway/internal
          timeout: 5000

     organization:
          name: ms-organization
          url: https://lab.vallegrande.edu.pe/jass/ms-gateway/internal
          timeout: 5000

# =============================================================================
# CONFIGURACIÓN DE DOCUMENTACIÓN (Swagger)
# =============================================================================
springdoc:
     api-docs:
          path: /v3/api/-docs
          enabled: true

     swagger-ui:
          path: /swagger-ui.html
          try-it-out-enabled: true
          operations-sorter: method
          tags-sorter: alpha
          display-request-duration: true
          disable-swagger-default-url: true

     show-actuator: false

# =============================================================================
# CONFIGURACIÓN DE ACTUATOR (MONITOREO) - OPTIMIZADO
# =============================================================================
management:
     endpoints:
          web:
               exposure:
                    # Solo exponer endpoints esenciales para reducir overhead
                    include: health,info
               base-path: /actuator

     endpoint:
          health:
               show-details: when-authorized
               show-components: when-authorized
               # Caché de health checks para reducir llamadas
               cache:
                    time-to-live: 10s

     # Reducir métricas para ahorrar memoria
     metrics:
          enable:
               jvm: false
               process: false
               system: false

     info:
          env:
               enabled: true
          git:
               mode: simple
