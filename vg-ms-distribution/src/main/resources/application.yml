spring:
     application:
          name: ${NOMBRE_MICROSERVICIO:vg-ms-distribution}

     # === OPTIMIZACIONES DE MEMORIA ===
     main:
          lazy-initialization: true
          banner-mode: off

     jmx:
          enabled: false

     output:
          ansi:
               enabled: never

     # === MONGODB OPTIMIZADO ===
     data:
          mongodb:
               uri: mongodb+srv://${MONGO_USERNAME}:${MONGO_PASSWORD}@${MONGO_HOST}/${MONGO_DATABASE}?retryWrites=true&w=majority&maxPoolSize=5&minPoolSize=1&maxIdleTimeMS=30000&serverSelectionTimeoutMS=5000
               auto-index-creation: false

     # === WEB OPTIMIZADO ===
     web:
          resources:
               cache:
                    period: 3600

     webflux:
          multipart:
               max-in-memory-size: 512B

     # === REACTOR NETTY OPTIMIZADO ===
     reactor:
          netty:
               pool:
                    max-connections: 5
                    max-idle-time: 3s
                    max-life-time: 20s

     # === JACKSON OPTIMIZADO ===
     jackson:
          serialization:
               write-dates-as-timestamps: false
               fail-on-empty-beans: false
          deserialization:
               fail-on-unknown-properties: false
          date-format: yyyy-MM-dd

     # === SECURITY OPTIMIZADO ===
     security:
          oauth2:
               resourceserver:
                    jwt:
                         issuer-uri: ${KEYCLOAK_ISSUER_URI}
                         jwk-set-uri: ${KEYCLOAK_JWK_SET_URI}
                         cache-duration: PT10M

     cloud:
          compatibility-verifier:
               enabled: false

# =============================================================================
# CONFIGURACIÓN DEL SERVIDOR OPTIMIZADA
# =============================================================================
server:
     port: ${PORT:8086}
     servlet:
          context-path: /jass/ms-distribution
     forward-headers-strategy: framework

     # === OPTIMIZACIONES DE MEMORIA ===
     netty:
          connection-timeout: 5s
          idle-timeout: 30s

     # === COMPRESIÓN PARA REDUCIR ANCHO DE BANDA ===
     compression:
          enabled: true
          mime-types: application/json,text/plain,text/html
          min-response-size: 1024

# =============================================================================
# CONFIGURACIÓN DE SEGURIDAD INTERNA (JWE)
# =============================================================================
jwe:
     internal:
          # Secreto compartido con el Gateway para la comunicación interna.
          secret: ${JWE_INTERNAL_SECRET}
          # Tiempo de expiración del token en segundos (86400s = 24 horas)
          expiration: ${JWE_INTERNAL_EXPIRATION}
          # Emisor del token (debe coincidir con el del gateway)
          issuer: ${JWE_INTERNAL_ISSUER}
          # Audiencia del token (debe coincidir con la configurada en el gateway)
          audience: ${JWE_INTERNAL_AUDIENCE}

# CORS configuration removed - handled by gateway

# =============================================================================
# INFORMACIÓN DE LA APLICACIÓN
# =============================================================================
app:
     name: Microservicio de Distribución
     description: Microservicio para gestión de Distribución del Sistema JASS Digital
     version: 2.0.0
     organization: Valle Grande

# =============================================================================
# CONFIGURACIÓN DE CLIENTES EXTERNOS (OTROS MICROSERVICIOS)
# =============================================================================
microservices:
     organization:
          name: ms-organizaciones
          url: ${ORGANIZATION_SERVICE_URL}
          timeout: 5000

# =============================================================================
# CONFIGURACIÓN DE SERVICIOS EXTERNOS
# =============================================================================
organization-service:
     base-url: ${ORGANIZATION_SERVICE_BASE_URL}
     token: ${ORGANIZATION_SERVICE_TOKEN}

# =============================================================================
# CONFIGURACIÓN DE ACTUATOR OPTIMIZADA (MÍNIMA)
# =============================================================================
management:
     endpoints:
          web:
               exposure:
                    include: health
               base-path: /actuator
          jmx:
               exposure:
                    exclude: "*"

     endpoint:
          health:
               show-details: never
               show-components: never
               cache:
                    time-to-live: 30s

     info:
          env:
               enabled: false
          git:
               mode: simple

     metrics:
          enable:
               all: false

# =============================================================================
# CONFIGURACIÓN DE LOGGING OPTIMIZADA PARA MEMORIA
# =============================================================================
logging:
     level:
          root: ERROR
          pe.edu.vallegrande: INFO
          org.springframework: WARN
          org.springframework.web: INFO
          org.springframework.data.mongodb: WARN
          org.mongodb.driver: WARN
          reactor.netty: WARN

     pattern:
          console: "%d{HH:mm:ss} %-5level %logger{36} - %msg%n"

     # Deshabilitamos logging a archivo para ahorrar memoria
     file:
          name: /dev/null

# =============================================================================
# CONFIGURACIÓN ADICIONAL DE LOGGING (COMENTADA - USAR LA CONFIGURACIÓN PRINCIPAL)
# =============================================================================
# Esta configuración está comentada porque ya existe una configuración principal de logging arriba
# Descomenta solo si necesitas configuraciones específicas adicionales

# =============================================================================
# CONFIGURACIÓN DE VALIDACIÓN
# =============================================================================
validation:
     user:
          code:
               prefix: USR
               length: 7
          document:
               dni-length: 8
               passport-min-length: 6
               passport-max-length: 12

# =============================================================================
# CONFIGURACIÓN ESPECÍFICA POR AMBIENTE
# =============================================================================
---
spring:
     config:
          activate:
               on-profile: dev

logging:
     level:
          pe.edu.vallegrande: DEBUG
          org.springframework.data.mongodb: DEBUG

---
spring:
     config:
          activate:
               on-profile: prod

logging:
     level:
          root: ERROR
          pe.edu.vallegrande: INFO
          org.springframework.web: INFO
          org.springframework.data.mongodb: WARN

server:
     error:
          include-stacktrace: never
          include-message: never
