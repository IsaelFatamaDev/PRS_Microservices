# =============================================================================
# MICROSERVICIO DE AUTENTICACION - SISTEMA JASS DIGITAL
# =============================================================================

spring:
     profiles:
          active: dev

     application:
          name: vg-ms-authentication

     web:
          resources:
               cache:
                    period: 0

     # OAuth2 Resource Server JWT Configuration
     security:
          oauth2:
               resourceserver:
                    jwt:
                         issuer-uri: https://lab.vallegrande.edu.pe/jass/keycloak/realms/${KEYCLOAK_REALM:sistema-jass}
                         jwk-set-uri: https://lab.vallegrande.edu.pe/jass/keycloak/realms/${KEYCLOAK_REALM:sistema-jass}/protocol/openid-connect/certs

# =============================================================================
# CONFIGURACIÓN DEL SERVIDOR
# =============================================================================
server:
     port: 9092
     forward-headers-strategy: framework

cors:
     allowed-origins: "*"
     allowed-methods: GET,POST,PUT,DELETE,PATCH,OPTIONS,HEAD
     allowed-headers: "*"
     allow-credentials: true
     max-age: 3600

# =============================================================================
# INFORMACIÓN DE LA APLICACIÓN Y MICROSERVICIOS EXTERNOS
# =============================================================================
app:
     name: Microservicio de Autenticación
     description: Microservicio para Autenticación del Sistema JASS Digital
     version: 2.0.0
     organization: Valle Grande

     services:
          users:
               url: ${MS_USERS_URL:https://genetic-yolane-vallegrandesistema-a92b57a3.koyeb.app/api}
               timeout: 5000

# =============================================================================
# CONFIGURACIÓN DE KEYCLOAK - UNA SOLA CONFIGURACIÓN SIMPLE
# =============================================================================
keycloak:
     url: https://lab.vallegrande.edu.pe/jass/keycloak
     realm: sistema-jass
     admin-username: admin
     admin-password: admin
     admin-client-id: admin-cli

     # Roles del sistema - ARREGLADO
     roles:
          - ADMIN
          - CLIENT
          - SUPER_ADMIN

# JWT Auth Converter Configuration
jwt:
     auth:
          converter:
               resource-id: ${KEYCLOAK_CLIENT_ID:jass-auth-service}
               principle-attribute: preferred_username

# =============================================================================
# CONFIGURACIÓN DE SEGURIDAD
# =============================================================================
security:
     password:
          policy:
               min-length: 8
               max-length: 50
               require-uppercase: true
               require-lowercase: true
               require-numbers: true
               require-symbols: true
               allowed-symbols: "!@#$%&*"

          # Contraseña temporal por defecto
          temporary:
               default: "TempJass2024!"
               force-change: true

     username:
          domain: "@jass.gob.pe"
          pattern: "^[a-zA-Z]+\\.[a-zA-Z]+@jass\\.gob\\.pe$"
          generation:
               use-first-name: true
               use-first-lastname: true
               lowercase: true

     session:
          timeout: 86400 # 24 horas en segundos
          refresh-threshold: 300 # 5 minutos antes de expirar

     audit:
          enabled: true

# =============================================================================
# CONFIGURACIÓN DE ACTUATOR (MONITOREO Y HEALTH CHECK)
# =============================================================================
management:
     endpoints:
          web:
               exposure:
                    include: health,info
               base-path: /actuator

     endpoint:
          health:
               show-details: when-authorized
               show-components: when-authorized

     health:
          defaults:
               enabled: true

# =============================================================================
# CONFIGURACIÓN DE DOCUMENTACIÓN (OpenAPI/Swagger)
# =============================================================================
springdoc:
     api-docs:
          path: /v3/api-docs
          enabled: true

     swagger-ui:
          path: /swagger-ui.html
          try-it-out-enabled: true
          operations-sorter: method
          tags-sorter: alpha
          display-request-duration: true
          disable-swagger-default-url: true

     show-actuator: false

# =============================================================================
# CONFIGURACIÓN DE LOGGING
# =============================================================================
logging:
     level:
          root: INFO
          pe.edu.vallegrande: DEBUG
          reactor.netty: INFO
          org.keycloak: DEBUG
          org.springframework.security: DEBUG

     pattern:
          console: "%d{yyyy-MM-dd HH:mm:ss} - %msg%n"
