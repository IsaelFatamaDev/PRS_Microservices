# =============================================================================
# PERFIL DE PRODUCCIÓN - OPTIMIZADO PARA 250 MiB
# =============================================================================

spring:
     # MongoDB con pool reducido
     data:
          mongodb:
               uri: mongodb+srv://sistemajass:ZC7O1Ok40SwkfEje@sistemajass.jn6cpoz.mongodb.net/JASS_DIGITAL?retryWrites=true&w=majority&maxPoolSize=5&minPoolSize=1&maxIdleTimeMS=30000
               database: JASS_DIGITAL
               auto-index-creation: false

     # Inicialización lazy para reducir memoria
     main:
          lazy-initialization: true
          banner-mode: off

     # Cache deshabilitado
     web:
          resources:
               cache:
                    enabled: false
               add-mappings: false

# =============================================================================
# REACTOR NETTY OPTIMIZADO
# =============================================================================
reactor:
     netty:
          # Solo 2 workers para reducir threads
          ioWorkerCount: 2
          pool:
               # Pool de conexiones reducido
               maxConnections: 50
               acquireTimeout: 3000
               maxIdleTime: 10000

# =============================================================================
# SERVIDOR CON LÍMITES AJUSTADOS
# =============================================================================
server:
     port: 9092
     forward-headers-strategy: framework

     # Netty optimizado para bajo consumo
     netty:
          connection-timeout: 5000
          idle-timeout: 30000

     # Compresión habilitada para reducir tráfico
     compression:
          enabled: true
          min-response-size: 1024

     # Límites de request
     max-http-request-header-size: 8KB

# =============================================================================
# WEBCLIENT CON TIMEOUTS CORTOS
# =============================================================================
app:
     services:
          users:
               url: ${MS_USERS_URL:https://genetic-yolane-vallegrandesistema-a92b57a3.koyeb.app/api}
               timeout: 3000
               max-connections: 10
               max-in-memory-size: 262144 # 256KB

# =============================================================================
# KEYCLOAK CON POOL REDUCIDO
# =============================================================================
keycloak:
     # Pool de conexiones HTTP reducido
     connection-pool-size: 3
     connection-ttl: 30000

# =============================================================================
# ACTUATOR MÍNIMO
# =============================================================================
management:
     endpoints:
          web:
               exposure:
                    include: health
               base-path: /actuator

     endpoint:
          health:
               show-details: never
               show-components: never

     health:
          defaults:
               enabled: false
          mongo:
               enabled: false
          diskspace:
               enabled: false

     metrics:
          enable:
               jvm: false
               process: false
               system: false
               http: false

# =============================================================================
# LOGGING MÍNIMO
# =============================================================================
logging:
     level:
          root: WARN
          pe.edu.vallegrande: INFO
          org.springframework: WARN
          org.keycloak: WARN
          org.springframework.security: WARN
          reactor.netty: WARN
          org.mongodb: WARN

     pattern:
          console: "%msg%n"

# =============================================================================
# DOCUMENTACIÓN DESHABILITADA EN PROD
# =============================================================================
springdoc:
     api-docs:
          enabled: false
     swagger-ui:
          enabled: false
